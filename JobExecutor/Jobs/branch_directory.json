{
  "jobName": "BranchDirectory",
  "firstEffectiveDate": "2024-10-01",
  "modules": [
    {
      "type": "DataSourcing",
      "resultName": "branches",
      "schema": "datalake",
      "table": "branches",
      "columns": ["branch_id", "branch_name", "address_line1", "city", "state_province", "postal_code", "country"]
    },
    {
      "type": "Transformation",
      "resultName": "branch_dir",
      "sql": "WITH branch_data AS (SELECT b.branch_id, b.branch_name, b.address_line1, b.city, b.state_province, b.postal_code, b.country, b.as_of, ROW_NUMBER() OVER (PARTITION BY b.branch_id ORDER BY b.branch_id) AS rn FROM branches b) SELECT branch_id, branch_name, address_line1, city, state_province, postal_code, country, as_of FROM branch_data WHERE rn = 1 ORDER BY branch_id"
    },
    {
      "type": "CsvFileWriter",
      "source": "branch_dir",
      "outputFile": "Output/curated/branch_directory.csv",
      "includeHeader": true,
      "writeMode": "Overwrite",
      "lineEnding": "CRLF"
    }
  ]
}
