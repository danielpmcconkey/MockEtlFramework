{
  "jobName": "CustomerContactInfo",
  "firstEffectiveDate": "2024-10-01",
  "modules": [
    {
      "type": "DataSourcing",
      "resultName": "phone_numbers",
      "schema": "datalake",
      "table": "phone_numbers",
      "columns": ["phone_id", "customer_id", "phone_type", "phone_number"]
    },
    {
      "type": "DataSourcing",
      "resultName": "email_addresses",
      "schema": "datalake",
      "table": "email_addresses",
      "columns": ["email_id", "customer_id", "email_address", "email_type"]
    },
    {
      "type": "DataSourcing",
      "resultName": "segments",
      "schema": "datalake",
      "table": "segments",
      "columns": ["segment_id", "segment_name"]
    },
    {
      "type": "Transformation",
      "resultName": "contact_info",
      "sql": "WITH all_contacts AS (SELECT customer_id, 'Phone' AS contact_type, phone_type AS contact_subtype, phone_number AS contact_value, as_of FROM phone_numbers UNION ALL SELECT customer_id, 'Email' AS contact_type, email_type AS contact_subtype, email_address AS contact_value, as_of FROM email_addresses) SELECT customer_id, contact_type, contact_subtype, contact_value, as_of FROM all_contacts ORDER BY customer_id, contact_type, contact_subtype"
    },
    {
      "type": "ParquetFileWriter",
      "source": "contact_info",
      "outputDirectory": "Output/curated/customer_contact_info/",
      "numParts": 2,
      "writeMode": "Append"
    }
  ]
}
